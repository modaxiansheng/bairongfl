{"remainingRequest":"E:\\bairongfl\\node_modules\\babel-loader\\lib\\index.js!E:\\bairongfl\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\bairongfl\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\bairongfl\\node_modules\\@bairong\\jax\\src\\components\\authorization\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\bairongfl\\node_modules\\@bairong\\jax\\src\\components\\authorization\\index.vue","mtime":499162500000},{"path":"E:\\bairongfl\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\bairongfl\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\bairongfl\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\bairongfl\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _defineProperty from \"E:\\\\bairongfl\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Cookies from 'js-cookie';\nimport Qs from 'qs';\nimport { mapGetters } from 'vuex';\nexport default {\n  name: 'Authorization',\n  props: {\n    value: {\n      type: Boolean,\n      default: false\n    },\n    title: {\n      type: String,\n      default: '授权范围'\n    },\n    submitUrl: {\n      type: String,\n      default: ''\n    }\n  },\n  data: function data() {\n    return {\n      loading: false,\n      isStrategyOp: false,\n      isHas: true,\n      save_loading: false,\n      visible: this.value,\n      formParams: {\n        id: '',\n        ownerId: '',\n        selectionTableArr: []\n      },\n      strategyParams: {\n        group: '',\n        // 策略分组 贷前loanBefore，loanBeforeRisk，贷中 loan，loanRisk，信息验证verify，verifyRisk\n        ownerId: '',\n        // ID\n        ownerName: '',\n        // 名称\n        strategyGroups: [],\n        // 策略分组\n        strategyId: 1,\n        // 策略ID\n        strategyCode: '',\n        // 策略Code\n        strategyName: '' // 策略名称\n\n      },\n      ruleInline: {\n        ownerId: [{\n          required: true,\n          message: '该项为必选项！'\n        }] // selectionTableArr: [{ required: true, type: 'array', min: 1, message: '请至少选择一项', trigger: 'change' }]\n\n      },\n      authStrategyCfg: {\n        group: 'loanRisk',\n        strategyCode: 'STRB0000053',\n        strategyId: '217',\n        strategyName: '测试数据01'\n      },\n      authStrategyCfg193: {\n        group: 'loanRisk',\n        strategyCode: 'STRB0000002',\n        strategyId: '41',\n        strategyName: '新建策略二'\n      },\n      authStrategyData: {\n        userList: []\n      },\n      options: {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        credentials: 'same-origin',\n        // 'same-origin', include\n        mode: 'cors',\n        cache: 'force-cache'\n      },\n      columns: [{\n        title: '权限组名称',\n        renderHeader: function renderHeader(h, params) {\n          return h('label', params.column.title);\n        },\n        // render: (h, params) => {\n        //   return h('div', [\n        //     h('Checkbox', {\n        //       props: {\n        //         label: params.row.name,\n        //         size: 'small'\n        //       },\n        //       style: {\n        //         marginRight: '5px'\n        //       },\n        //       on: {\n        //         click: () => {\n        //           this.show(params.index)\n        //         }\n        //       }\n        //     }, params.row.name)\n        //   ]);\n        // },\n        key: 'name'\n      }, {\n        // type: 'selection',\n        title: '读权限',\n        renderHeader: function renderHeader(h, params) {\n          // console.log(h, params);\n          return h('label', params.column.title);\n        },\n        align: 'center',\n        children: [{\n          title: '读权限',\n          type: 'selection',\n          key: 'rangeType',\n          // className: 'def-show-column',\n          align: 'center' // },\n          // {\n          //   title: 'Company Name',\n          //   key: 'cname',\n          //   align: 'center',\n          //   width: 100\n\n        }]\n      }],\n      strategyDataGroup: [],\n      strategyDataGroup1: [{\n        name: '组1',\n        rangeType: 2\n      }, {\n        name: '组2',\n        rangeType: 1\n      }]\n    };\n  },\n  computed: _objectSpread({}, mapGetters('user/', {\n    authData: 'authData'\n  })),\n  methods: {\n    uniqueArr: function uniqueArr(array) {\n      // 数组去重\n      var n = []; // 一个新的临时数组 uid\n\n      var keyObj = {};\n      array.forEach(function (item) {\n        keyObj[item.uid] = item;\n      });\n      Object.keys(keyObj).forEach(function (key) {\n        n.push(keyObj[key]);\n      });\n      return n;\n    },\n    initData: function initData() {\n      var _ref = this.authData || {},\n          permissionGroups = _ref.permissionGroups;\n\n      var _ref2 = permissionGroups || {},\n          adminUser = _ref2.adminUser,\n          dataGroupUser = _ref2.dataGroupUser;\n\n      var adminUserArr = adminUser || [];\n      var concatNoUniqueArr = adminUserArr.concat(dataGroupUser || []); // this.authStrategyData.userList = (permissionGroups && permissionGroups.dataGroupUser) || [];\n\n      this.authStrategyData.userList = this.uniqueArr(concatNoUniqueArr);\n\n      if (this.authStrategyData.userList && !this.authStrategyData.userList.length) {\n        this.$Message.error('用户所在组数据为空错误！');\n      }\n    },\n    initStrategy: function initStrategy() {\n      var _this = this;\n\n      this.loading = true;\n      this.options.method = 'GET';\n      var url = '/api/auth-service/resourceStrategy/strategyMessage';\n\n      if (this.options.method === 'GET') {\n        url = url + '?' + Qs.stringify(this.getSid()) + '&' + Qs.stringify(this.authStrategyCfg);\n        delete this.options.body;\n      } else {\n        this.options.body = Qs.stringify(this.getSid()) + '&' + Qs.stringify(this.authStrategyCfg);\n      }\n\n      fetch(url, this.options).then(function (response) {\n        return response.json();\n      }).then(function (_ref3) {\n        var code = _ref3.code,\n            data = _ref3.data,\n            message = _ref3.message;\n        _this.loading = false;\n\n        if (code === '000000') {\n          _this.authStrategyData = data;\n\n          if (_this.authStrategyData && _this.authStrategyData.userList && !_this.authStrategyData.userList.length) {\n            _this.$Message.error('用户所在组数据为空错误！');\n          } // 0: 读写；1，读；2，写 (默认只有 1：读 的权限)  其他的就是没有勾选的状态\n\n\n          var singleSelectArr = []; // 选中状态条件\n\n          _this.authStrategyData && _this.authStrategyData.groups && _this.authStrategyData.groups.map(function (item) {\n            item.isReadSelected = false;\n            item.isWriteSelected = false;\n            item._checked = false;\n\n            if (item.rangeType === 0 || item.rangeType === 1) {\n              item.isReadSelected = true; // 读 选中\n\n              item._checked = true;\n              var obj = {\n                id: item.id,\n                name: item.name,\n                rangeType: item.rangeType\n              };\n              singleSelectArr.push(obj);\n            }\n          });\n          _this.formParams.selectionTableArr = singleSelectArr;\n          _this.strategyParams.strategyGroups = singleSelectArr;\n          _this.strategyDataGroup = _this.authStrategyData.groups || [];\n        } else {\n          _this.$Message.error(message || '服务器错误！');\n        }\n      }, function (reason) {\n        _this.$Message.error(reason || '服务器错误！');\n      });\n    },\n    getSid: function getSid() {\n      var sessionId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Cookies.get('BR_COMPASS_SESSIONID');\n      return {\n        sessionId: sessionId,\n        t: Date.now()\n      };\n    },\n    setId: function setId(_ref4) {\n      var id = _ref4.id;\n      this.formParams.id = id;\n    },\n    selectUserData: function selectUserData(selectData) {\n      if (selectData && selectData.value) {\n        // console.log(200, this.formParams.ownerId, selectData.value);\n        this.strategyParams.ownerId = selectData.value;\n        this.strategyParams.ownerName = selectData.label;\n      }\n    },\n    selectRetryHandle: function selectRetryHandle(selectionArr) {\n      var singleSelectArr = [];\n      selectionArr.map(function (sItem) {\n        var obj = {\n          id: sItem.id,\n          name: sItem.name,\n          rangeType: sItem.rangeType\n        };\n        singleSelectArr.push(obj);\n      });\n      this.formParams.selectionTableArr = selectionArr;\n      this.strategyParams.strategyGroups = singleSelectArr;\n    },\n    resetParams: function resetParams() {\n      this.save_loading = false;\n    },\n    strategySubmit: function strategySubmit() {\n      this.strategyParams.group = this.authStrategyCfg.group;\n      this.strategyParams.strategyId = this.authStrategyCfg.strategyId;\n      this.strategyParams.strategyCode = this.authStrategyCfg.strategyCode;\n      this.strategyParams.strategyName = this.authStrategyCfg.strategyName; // this.options.body = Qs.stringify(this.getSid()) + '&' + Qs.stringify(this.strategyParams);\n\n      this.options.body = JSON.stringify(this.strategyParams); // obj = JSON.parse(obj);\n\n      this.options.method = 'POST';\n      this.options.headers = {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      };\n      var url = '/api/auth-service/resourceStrategy/changeOwner' + '?' + Qs.stringify(this.getSid());\n      this.saveFetch(url, this.options);\n    },\n    submit: function submit() {\n      var _this$formParams = this.formParams,\n          id = _this$formParams.id,\n          ownerId = _this$formParams.ownerId;\n      this.options.body = Qs.stringify(_objectSpread({\n        id: id,\n        ownerId: ownerId\n      }, this.getSid()));\n      this.options.method = 'POST';\n      this.options.headers = {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      };\n      this.saveFetch(this.submitUrl, this.options);\n    },\n    saveFetch: function saveFetch(url, options) {\n      var _this2 = this;\n\n      fetch(url, options).then(function (response) {\n        return response.json();\n      }).then(function (_ref5) {\n        var code = _ref5.code,\n            message = _ref5.message;\n\n        if (code === '00' || code === '000000') {\n          _this2.$Message.success(\"\\u4FDD\\u5B58\".concat(message, \"\\uFF01\"));\n\n          _this2.$emit('save-success');\n\n          _this2.cancel();\n        } else {\n          _this2.$Message.error(message || '服务器错误！');\n\n          _this2.resetParams();\n        }\n      }, function (reason) {\n        _this2.$Message.error(reason || '服务器错误！');\n\n        _this2.resetParams();\n      });\n    },\n    ok: function ok() {\n      var _this3 = this;\n\n      this.save_loading = true;\n      this.$refs.authForm.validate(function (valid) {\n        // valid ? this.submit() : (this.save_loading = false);\n        valid ? _this3.isStrategyOp ? _this3.strategySubmit() : _this3.submit() : _this3.save_loading = false;\n      });\n    },\n    cancel: function cancel() {\n      this.visible = false;\n      this.$emit('input', false);\n      this.$refs.authForm.resetFields();\n      this.resetParams();\n    }\n  },\n  watch: {\n    value: function value(v) {\n      this.visible = v;\n    }\n  },\n  mounted: function mounted() {\n    var _this4 = this;\n\n    var _ref6 = this.authData || {},\n        id = _ref6.id;\n\n    this.$parent.$on('authorization', function (evt) {\n      _this4.formParams.ownerId = id;\n      _this4.isStrategyOp = false;\n\n      _this4.setId(evt);\n\n      _this4.initData();\n    });\n    this.$parent.$on('authStrategyEvent', function (evt) {\n      _this4.formParams.ownerId = id;\n      _this4.isStrategyOp = true;\n      _this4.authStrategyCfg.group = evt.group;\n      _this4.authStrategyCfg.strategyId = evt.strategyId;\n      _this4.authStrategyCfg.strategyCode = evt.strategyCode;\n      _this4.authStrategyCfg.strategyName = evt.strategyName;\n\n      _this4.initStrategy();\n\n      _this4.$forceUpdate();\n    });\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <Modal v-model=\"visible\" :title=\"title\" @on-cancel=\"cancel\">\n    <Form ref=\"authForm\" :model=\"formParams\" :rules=\"ruleInline\">\n      <FormItem  :label-width=\"100\" prop=\"ownerId\" label=\"变更所有者\">\n        <Select v-model=\"formParams.ownerId\" :label-in-value=\"true\" @on-change=\"selectUserData\" style=\"width:300px\" placeholder=\"请选择\">\n          <Option v-for=\"item in authStrategyData.userList\" :value=\"item.uid\" :key=\"item.uid\">{{ item.userName }}</Option>\n        </Select>\n      </FormItem>\n      <FormItem v-if=\"isStrategyOp\" :label-width=\"100\" label=\"读权限\">\n        <Table height=\"300\" border ref=\"selection\" :columns=\"columns\" :loading=\"loading\" :data=\"strategyDataGroup\" @on-selection-change=\"selectRetryHandle\"></Table>\n      </FormItem>\n      <!--<FormItem v-if=\"isStrategyOp\" prop=\"selectionTableArr\" :label-width=\"100\" label=\"读权限\">-->\n        <!--<Table height=\"300\" border ref=\"selection\" :columns=\"columns\" :data=\"strategyDataGroup\" @on-selection-change=\"selectRetryHandle\"></Table>-->\n      <!--</FormItem>-->\n    </Form>\n    <template slot=\"footer\">\n      <Button type=\"primary\" :loading=\"save_loading\" @click=\"ok\">保存</Button>\n      <Button type=\"text\" @click=\"cancel\">取消</Button>\n    </template>\n  </Modal>\n</template>\n\n<script>\nimport Cookies from 'js-cookie';\nimport Qs from 'qs';\nimport { mapGetters } from 'vuex';\nexport default {\n  name: 'Authorization',\n  props: {\n    value: { type: Boolean, default: false },\n    title: { type: String, default: '授权范围' },\n    submitUrl: { type: String, default: '' }\n  },\n  data () {\n    return {\n      loading: false,\n      isStrategyOp: false,\n      isHas: true,\n      save_loading: false,\n      visible: this.value,\n      formParams: { id: '', ownerId: '', selectionTableArr: [] },\n      strategyParams: {\n        group: '', // 策略分组 贷前loanBefore，loanBeforeRisk，贷中 loan，loanRisk，信息验证verify，verifyRisk\n        ownerId: '', // ID\n        ownerName: '', // 名称\n        strategyGroups: [], // 策略分组\n        strategyId: 1, // 策略ID\n        strategyCode: '', // 策略Code\n        strategyName: '' // 策略名称\n      },\n      ruleInline: {\n        ownerId: [{ required: true, message: '该项为必选项！' }]\n        // selectionTableArr: [{ required: true, type: 'array', min: 1, message: '请至少选择一项', trigger: 'change' }]\n      },\n      authStrategyCfg: {\n        group: 'loanRisk',\n        strategyCode: 'STRB0000053',\n        strategyId: '217',\n        strategyName: '测试数据01'\n      },\n      authStrategyCfg193: {\n        group: 'loanRisk',\n        strategyCode: 'STRB0000002',\n        strategyId: '41',\n        strategyName: '新建策略二'\n      },\n      authStrategyData: {\n        userList: []\n      },\n      options: {\n        method: 'GET',\n        headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' },\n        credentials: 'same-origin', // 'same-origin', include\n        mode: 'cors',\n        cache: 'force-cache'\n      },\n      columns: [\n        {\n          title: '权限组名称',\n          renderHeader: (h, params) => {\n            return h('label', params.column.title);\n          },\n          // render: (h, params) => {\n          //   return h('div', [\n          //     h('Checkbox', {\n          //       props: {\n          //         label: params.row.name,\n          //         size: 'small'\n          //       },\n          //       style: {\n          //         marginRight: '5px'\n          //       },\n          //       on: {\n          //         click: () => {\n          //           this.show(params.index)\n          //         }\n          //       }\n          //     }, params.row.name)\n          //   ]);\n          // },\n          key: 'name'\n        },\n        {\n          // type: 'selection',\n          title: '读权限',\n          renderHeader: (h, params) => {\n            // console.log(h, params);\n            return h('label', params.column.title);\n          },\n          align: 'center',\n          children: [\n            {\n              title: '读权限',\n              type: 'selection',\n              key: 'rangeType',\n              // className: 'def-show-column',\n              align: 'center'\n              // },\n              // {\n              //   title: 'Company Name',\n              //   key: 'cname',\n              //   align: 'center',\n              //   width: 100\n            }\n          ]\n        }\n      ],\n      strategyDataGroup: [],\n      strategyDataGroup1: [\n        {\n          name: '组1',\n          rangeType: 2\n        },\n        {\n          name: '组2',\n          rangeType: 1\n        }\n      ]\n    };\n  },\n  computed: {\n    ...mapGetters('user/', { authData: 'authData' })\n  },\n  methods: {\n    uniqueArr (array) {\n      // 数组去重\n      var n = []; // 一个新的临时数组 uid\n      var keyObj = {};\n      array.forEach((item) => {\n        keyObj[item.uid] = item;\n      });\n      Object.keys(keyObj).forEach(function (key) {\n        n.push(keyObj[key]);\n      });\n      return n;\n    },\n    initData () {\n      const { permissionGroups } = this.authData || {};\n      const { adminUser, dataGroupUser } = permissionGroups || {};\n      let adminUserArr = adminUser || [];\n      let concatNoUniqueArr = adminUserArr.concat(dataGroupUser || []);\n      // this.authStrategyData.userList = (permissionGroups && permissionGroups.dataGroupUser) || [];\n      this.authStrategyData.userList = this.uniqueArr(concatNoUniqueArr);\n      if (this.authStrategyData.userList && !this.authStrategyData.userList.length) {\n        this.$Message.error('用户所在组数据为空错误！');\n      }\n    },\n    initStrategy () {\n      this.loading = true;\n      this.options.method = 'GET';\n      let url = '/api/auth-service/resourceStrategy/strategyMessage';\n      if (this.options.method === 'GET') {\n        url = url + '?' + Qs.stringify(this.getSid()) + '&' + Qs.stringify(this.authStrategyCfg);\n        delete this.options.body;\n      } else {\n        this.options.body = Qs.stringify(this.getSid()) + '&' + Qs.stringify(this.authStrategyCfg);\n      }\n      fetch(url, this.options)\n        .then(response => response.json())\n        .then(({ code, data, message }) => {\n          this.loading = false;\n          if (code === '000000') {\n            this.authStrategyData = data;\n            if (this.authStrategyData && this.authStrategyData.userList && !this.authStrategyData.userList.length) {\n              this.$Message.error('用户所在组数据为空错误！');\n            }\n            // 0: 读写；1，读；2，写 (默认只有 1：读 的权限)  其他的就是没有勾选的状态\n            let singleSelectArr = []; // 选中状态条件\n            this.authStrategyData && this.authStrategyData.groups && this.authStrategyData.groups.map((item) => {\n              item.isReadSelected = false;\n              item.isWriteSelected = false;\n              item._checked = false;\n              if (item.rangeType === 0 || item.rangeType === 1) {\n                item.isReadSelected = true; // 读 选中\n                item._checked = true;\n                let obj = {\n                  id: item.id,\n                  name: item.name,\n                  rangeType: item.rangeType\n                };\n                singleSelectArr.push(obj);\n              }\n            });\n            this.formParams.selectionTableArr = singleSelectArr;\n            this.strategyParams.strategyGroups = singleSelectArr;\n            this.strategyDataGroup = this.authStrategyData.groups || [];\n          } else {\n            this.$Message.error(message || '服务器错误！');\n          }\n        }, reason => {\n          this.$Message.error(reason || '服务器错误！');\n        });\n    },\n    getSid (sessionId = Cookies.get('BR_COMPASS_SESSIONID')) {\n      return { sessionId, t: Date.now() };\n    },\n    setId ({ id }) {\n      this.formParams.id = id;\n    },\n    selectUserData (selectData) {\n      if (selectData && selectData.value) {\n        // console.log(200, this.formParams.ownerId, selectData.value);\n        this.strategyParams.ownerId = selectData.value;\n        this.strategyParams.ownerName = selectData.label;\n      }\n    },\n    selectRetryHandle (selectionArr) {\n      let singleSelectArr = [];\n      selectionArr.map(sItem => {\n        let obj = {\n          id: sItem.id,\n          name: sItem.name,\n          rangeType: sItem.rangeType\n        };\n        singleSelectArr.push(obj);\n      });\n      this.formParams.selectionTableArr = selectionArr;\n      this.strategyParams.strategyGroups = singleSelectArr;\n    },\n    resetParams () {\n      this.save_loading = false;\n    },\n    strategySubmit () {\n      this.strategyParams.group = this.authStrategyCfg.group;\n      this.strategyParams.strategyId = this.authStrategyCfg.strategyId;\n      this.strategyParams.strategyCode = this.authStrategyCfg.strategyCode;\n      this.strategyParams.strategyName = this.authStrategyCfg.strategyName;\n      // this.options.body = Qs.stringify(this.getSid()) + '&' + Qs.stringify(this.strategyParams);\n      this.options.body = JSON.stringify(this.strategyParams); // obj = JSON.parse(obj);\n      this.options.method = 'POST';\n      this.options.headers = { 'Accept': 'application/json', 'Content-Type': 'application/json' };\n      let url = '/api/auth-service/resourceStrategy/changeOwner' + '?' + Qs.stringify(this.getSid());\n      this.saveFetch(url, this.options);\n    },\n    submit () {\n      let { id, ownerId } = this.formParams;\n      this.options.body = Qs.stringify({ id, ownerId, ...this.getSid() });\n      this.options.method = 'POST';\n      this.options.headers = { 'Content-Type': 'application/x-www-form-urlencoded' };\n      this.saveFetch(this.submitUrl, this.options);\n    },\n    saveFetch (url, options) {\n      fetch(url, options)\n        .then(response => response.json())\n        .then(({ code, message }) => {\n          if (code === '00' || code === '000000') {\n            this.$Message.success(`保存${message}！`);\n            this.$emit('save-success');\n            this.cancel();\n          } else {\n            this.$Message.error(message || '服务器错误！');\n            this.resetParams();\n          }\n        }, reason => {\n          this.$Message.error(reason || '服务器错误！');\n          this.resetParams();\n        });\n    },\n    ok () {\n      this.save_loading = true;\n      this.$refs.authForm.validate(valid => {\n        // valid ? this.submit() : (this.save_loading = false);\n        valid ? (this.isStrategyOp ? this.strategySubmit() : this.submit()) : (this.save_loading = false);\n      });\n    },\n    cancel () {\n      this.visible = false;\n      this.$emit('input', false);\n      this.$refs.authForm.resetFields();\n      this.resetParams();\n    }\n  },\n  watch: {\n    value (v) {\n      this.visible = v;\n    }\n  },\n  mounted () {\n    const { id } = this.authData || {};\n    this.$parent.$on('authorization', (evt) => {\n      this.formParams.ownerId = id;\n      this.isStrategyOp = false;\n      this.setId(evt);\n      this.initData();\n    });\n    this.$parent.$on('authStrategyEvent', (evt) => {\n      this.formParams.ownerId = id;\n      this.isStrategyOp = true;\n      this.authStrategyCfg.group = evt.group;\n      this.authStrategyCfg.strategyId = evt.strategyId;\n      this.authStrategyCfg.strategyCode = evt.strategyCode;\n      this.authStrategyCfg.strategyName = evt.strategyName;\n      this.initStrategy();\n      this.$forceUpdate();\n    });\n  }\n};\n</script>\n"],"sourceRoot":"node_modules/@bairong/jax/src/components/authorization"}]}