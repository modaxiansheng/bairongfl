{"remainingRequest":"E:\\bairongfl\\node_modules\\babel-loader\\lib\\index.js!E:\\bairongfl\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\bairongfl\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\bairongfl\\node_modules\\@bairong\\jax\\src\\components\\rules\\PresetRuleChange.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\bairongfl\\node_modules\\@bairong\\jax\\src\\components\\rules\\PresetRuleChange.vue","mtime":499162500000},{"path":"E:\\bairongfl\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\bairongfl\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\bairongfl\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\bairongfl\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport _defineProperty from \"E:\\\\bairongfl\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.match\";\nimport _typeof from \"E:\\\\bairongfl\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/typeof\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/**\n * 风险提示弹出框\n * 使用说明：\n * 如弹框引用 <PresetRuleChange width=\"680\" @save-confirm=\"saveConfirmOk\"></PresetRuleChange>\n *  发消息来 presetRuleChangeEvent,如下：\n *  this.$emit('presetRuleChangeEvent', {\n        type: 6, // 业务分类 1:贷前;5:验证;6:贷中,必传项\n        ruleType: 'Rule_W_SpecialList_c_pdl', // 规则集编码\n        typeVersion: '1.0', // 规则集版本号\n        ids: ['246725', '246726'] // 公司内部预置规则id数组\n      });\n * 2019.3.4\n * hl\n */\nimport TableMergeCell from \"../table/TableMergeCell\";\nimport Cookies from 'js-cookie';\nimport Qs from 'qs';\nexport default {\n  name: 'PresetRuleChange',\n  components: {\n    TableMergeCell: TableMergeCell\n  },\n  props: {\n    value: {\n      type: Boolean,\n      default: false\n    },\n    title: {\n      type: String,\n      default: '风险提示'\n    },\n    width: {\n      default: 600\n    }\n  },\n  data: function data() {\n    return {\n      loading: false,\n      save_loading: false,\n      visible: this.value,\n      authStrategyCfgEg: {\n        type: 6,\n        // 业务分类 1:贷前;5:验证;6:贷中,必传项\n        ruleType: 'Rule_W_SpecialList_c_pdl',\n        // 规则集编码\n        typeVersion: '1.0',\n        // 规则集版本号\n        ids: ['246725', '246726'] // 公司内部预置规则id数组\n\n      },\n      authStrategyCfg: {},\n      options: {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        credentials: 'same-origin',\n        // 'same-origin', include\n        mode: 'cors',\n        cache: 'force-cache'\n      },\n      columnsPresetRule: [{\n        title: '规则编号',\n        width: 85,\n        merge: 'ruleCode',\n        key: 'ruleCode'\n      }, {\n        title: '修改参数',\n        width: 85,\n        key: 'nameChange'\n      }, {\n        title: '当前规则',\n        render: function render(h, params) {\n          var isLogic = !!(params.row.currentRule && _typeof(params.row.currentRule) === 'object');\n          var names = isLogic ? params.row.currentRule : [];\n          var liArr = [];\n\n          for (var i = 0; i < names.length; i++) {\n            var itemSpan = h('span', names[i]);\n            var itemLi = h('li', {\n              style: {\n                'margin-bottom': '3px',\n                'list-style': 'none'\n              }\n            }, [itemSpan]);\n            liArr.push(itemLi);\n          }\n\n          return isLogic ? h('ul', [liArr]) : h('span', params.row.currentRule);\n        },\n        key: 'currentRule'\n      }, {\n        title: '变更后规则',\n        render: function render(h, params) {\n          var isLogic = !!(params.row.afterRule && _typeof(params.row.afterRule) === 'object');\n          var names = isLogic ? params.row.afterRule : [];\n          var liArr = [];\n\n          for (var i = 0; i < names.length; i++) {\n            var itemSpan = h('span', names[i]);\n            var itemLi = h('li', {\n              style: {\n                'margin-bottom': '3px',\n                'list-style': 'none'\n              }\n            }, [itemSpan]);\n            liArr.push(itemLi);\n          }\n\n          return isLogic ? h('ul', [liArr]) : h('span', params.row.afterRule);\n        },\n        key: 'afterRule'\n      }],\n      strategyDataGroup: []\n    };\n  },\n  methods: {\n    // 一个编号下面，多个数组表达式组成的字符数据\n    ruleLogicStr: function ruleLogicStr(jsonVal) {\n      var length = jsonVal.fieldsZn ? jsonVal.fieldsZn.length : 0; /// 逻辑符号 把数据库中 两个以上 这种 [\"||\",\"\"] 修改为 [\"\",\"||\"]\n      // let logicsArr = jsonVal.logics;\n      // if (logicsArr && logicsArr.length >= 2) {\n      //   logicsArr.unshift(logicsArr[logicsArr.length - 1]); // 从最后添加到第一个位置\n      //   logicsArr.pop(); // 把最后一个符号删除掉\n      // } else {\n      //   logicsArr = jsonVal.logics;\n      // }\n      // jsonVal.logicArr = logicsArr;\n      // console.log('logics', jsonVal.logics, logicsArr)\n\n      var ruleLogicList = [];\n      var expression = '';\n\n      for (var i = 0; i < length; i++) {\n        var ruleLogic = {};\n        ruleLogic.leftBracks = /^\\(/g.test(jsonVal.fieldsZn[i]) ? ' ( ' : ' '; // 括号\n        // ruleLogic.rightBracks = !!/\\)$/g.test(jsonVal.fieldsZn[i]); // 括号\n\n        ruleLogic.rightBracks = /\\)$/g.test(jsonVal.params[i]) ? ' ) ' : ' '; // 括号\n\n        ruleLogic.field = jsonVal.fieldsZn[i].match(/([^()]+)/g)[0];\n        ruleLogic.operator = ' ' + jsonVal.operators[i] + ' ';\n        ruleLogic.logic = jsonVal.logics[i] + ' '; // ruleLogic.param = parseFloat(jsonVal.params[i]) + '';\n\n        ruleLogic.param = parseFloat(jsonVal.params[i].match(/([^()]+)/g)[0]) + ' ';\n        ruleLogic.index = i;\n        expression = ruleLogic.leftBracks + ruleLogic.field + ruleLogic.operator + ruleLogic.param + ruleLogic.rightBracks + ruleLogic.logic;\n        ruleLogicList.push(expression);\n      }\n\n      return ruleLogicList;\n    },\n    ruleDataFormat: function ruleDataFormat(item, columnName, ruleItem) {\n      var _this = this;\n\n      Object.keys(item).forEach(function (key, i) {\n        switch (key) {\n          case 'ruleName':\n            if (item.ruleName) {\n              ruleItem.ruleName = _objectSpread({}, ruleItem.ruleName, {\n                ruleCode: item.ruleCode,\n                nameChange: '规则名称'\n              });\n              ruleItem.ruleName[columnName] = item.ruleName;\n            }\n\n            break;\n\n          case 'priority':\n            if (item.priority + '' === '0' || item.priority >= 1) {\n              ruleItem.priority = _objectSpread({}, ruleItem.priority, {\n                ruleCode: item.ruleCode,\n                nameChange: '规则权重'\n              });\n              ruleItem.priority[columnName] = item.priority;\n            }\n\n            break;\n\n          case 'status':\n            if (item.status + '' === '0' || item.status + '' === '1') {\n              ruleItem.status = _objectSpread({}, ruleItem.status, {\n                ruleCode: item.ruleCode,\n                nameChange: '规则状态'\n              });\n              ruleItem.status[columnName] = item.status + '' === '1' ? '启用' : '禁用';\n            }\n\n            break;\n\n          case 'jsonStr':\n            if (item.jsonStr && item.jsonStr.fieldsZn) {\n              ruleItem.jsonStr = _objectSpread({}, ruleItem.jsonStr, {\n                ruleCode: item.ruleCode,\n                nameChange: '规则逻辑'\n              });\n              ruleItem.jsonStr[columnName] = _this.ruleLogicStr(item.jsonStr);\n            }\n\n            break;\n        }\n      });\n      return ruleItem;\n    },\n    initStrategy: function initStrategy() {\n      var _this2 = this;\n\n      this.loading = true; // this.options.method = 'GET';\n\n      this.options.method = 'POST';\n      var url = '/api/rulecenter-service/newBRule/enablingPresetRuleChangeContrast';\n\n      if (this.options.method === 'GET') {\n        url = url + '?' + Qs.stringify(this.getSid()) + '&' + Qs.stringify(this.authStrategyCfg);\n        delete this.options.body;\n      } else {\n        // this.options.body = Qs.stringify(this.getSid()) + '&' + Qs.stringify(this.authStrategyCfg);\n        url = url + '?' + Qs.stringify(this.getSid());\n        this.options.body = JSON.stringify(this.authStrategyCfg); // 转换为一个 JSON字符串\n      }\n\n      fetch(url, this.options).then(function (response) {\n        return response.json();\n      }).then(function (_ref) {\n        var code = _ref.code,\n            data = _ref.data,\n            message = _ref.message;\n        _this2.loading = false;\n\n        if (code === '000000') {\n          var groupDataArr = []; // let demoData = JSON.parse('{\"code\":\"000000\",\"data\":[{\"afterAlterationRule\":{\"id\":271122,\"jsonStr\":{\"ruleType\":\"Rule_C_AirTravel_d1\",\"ruleName\":\"航空消费能力较低\",\"priority\":10,\"operators\":[\"<=\"],\"fieldsZn\":[\"航空消费能力等级\"],\"ruleCode\":\"FAA001\",\"params\":[\"23\"],\"logics\":[\"\"],\"fields\":[\"i_AirExpense_score\"]},\"priority\":null,\"ruleCode\":\"FAA001\",\"ruleName\":\"\",\"status\":null},\"currentRule\":{\"id\":471229,\"jsonStr\":{\"ruleType\":\"Rule_C_AirTravel_d1\",\"ruleName\":\"航空消费能力较低\",\"priority\":10,\"operators\":[\"<=\"],\"fieldsZn\":[\"航空消费能力等级\"],\"ruleCode\":\"FAA001\",\"params\":[\"25\"],\"logics\":[\"\"],\"fields\":[\"i_AirExpense_score\"]},\"priority\":null,\"ruleCode\":\"FAA001\",\"ruleName\":\"\",\"status\":null}},{\"afterAlterationRule\":{\"id\":271123,\"jsonStr\":{\"ruleType\":\"Rule_C_AirTravel_d1\",\"ruleName\":\"航空消费能力较高\",\"priority\":5,\"operators\":[\">=\",\"<=\"],\"fieldsZn\":[\"航空消费能力等级\",\"航空消费能力等级\"],\"ruleCode\":\"FAA002\",\"params\":[\"25\",\"59\"],\"logics\":[\"且\",\"\"],\"fields\":[\"i_AirExpense_score\",\"i_AirExpense_score\"]},\"priority\":null,\"ruleCode\":\"FAA002\",\"ruleName\":\"\",\"status\":null},\"currentRule\":{\"id\":471230,\"jsonStr\":{\"ruleType\":\"Rule_C_AirTravel_d1\",\"ruleName\":\"航空消费能力较高\",\"priority\":5,\"operators\":[\">=\",\"<=\"],\"fieldsZn\":[\"航空消费能力等级\",\"航空消费能力等级\"],\"ruleCode\":\"FAA002\",\"params\":[\"25\",\"61\"],\"logics\":[\"且\",\"\"],\"fields\":[\"i_AirExpense_score\",\"i_AirExpense_score\"]},\"priority\":null,\"ruleCode\":\"FAA002\",\"ruleName\":\"\",\"status\":null}}],\"message\":\"成功\"}');\n          // let data = demoData.data;\n\n          if (data && data.length >= 1) {\n            _this2.visible = true;\n            data.forEach(function (item) {\n              // 增加列字段columnName currentRule afterRule\n              var currentRule = _this2.ruleDataFormat(item.currentRule, 'currentRule', {});\n\n              var mergeRule = _this2.ruleDataFormat(item.afterAlterationRule, 'afterRule', currentRule); // mergeRule.jsonStr.afterRule = 'afterAlterationRuleafterAlterationRuleafterAlterationRuleafterAlterationRule'.split('e')\n\n\n              Object.keys(mergeRule).forEach(function (key, i) {\n                groupDataArr.push(mergeRule[key]);\n              });\n            });\n          } else {\n            _this2.visible = false;\n\n            _this2.$emit('save-confirm');\n          }\n\n          _this2.strategyDataGroup = groupDataArr;\n        } else {\n          _this2.$Message.error(message || '服务器错误！');\n        }\n      }, function (reason) {\n        _this2.$Message.error(reason || '服务器错误！');\n      });\n    },\n    getSid: function getSid() {\n      var sessionId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Cookies.get('BR_COMPASS_SESSIONID');\n      return {\n        sessionId: sessionId,\n        t: Date.now()\n      };\n    },\n    resetParams: function resetParams() {\n      this.save_loading = false;\n    },\n    ok: function ok() {\n      // this.save_loading = true;\n      this.$emit('save-confirm');\n      this.visible = false;\n      this.resetParams();\n    },\n    cancel: function cancel() {\n      this.visible = false;\n      this.$emit('input', false);\n      this.resetParams();\n    }\n  },\n  watch: {\n    value: function value(v) {\n      this.visible = v;\n    }\n  },\n  mounted: function mounted() {\n    var _this3 = this;\n\n    this.$parent.$on('presetRuleChangeEvent', function (evt) {\n      _this3.authStrategyCfg.type = evt.type;\n      _this3.authStrategyCfg.typeVersion = evt.typeVersion;\n      _this3.authStrategyCfg.ruleType = evt.ruleType;\n      _this3.authStrategyCfg.ids = evt.ids;\n\n      _this3.initStrategy();\n\n      _this3.$forceUpdate();\n    });\n  }\n};",{"version":3,"sources":["PresetRuleChange.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <Modal v-model=\"visible\" :title=\"title\" @on-cancel=\"cancel\" :width=\"width\">\n    <span>启用预置规则，将会覆盖您当前的部分规则，可能会影响您的风险政策，受影响的规则情况如下，请确认是否启动预置规则：</span>\n    <TableMergeCell style=\"margin: 16px 0;\" height=\"320px\" :columns=\"columnsPresetRule\" :data=\"strategyDataGroup\"></TableMergeCell>\n    <template slot=\"footer\">\n      <Button type=\"primary\" :loading=\"save_loading\" @click=\"ok\">确认启用</Button>\n      <Button type=\"text\" @click=\"cancel\">取消</Button>\n    </template>\n  </Modal>\n</template>\n<script>\n/**\n * 风险提示弹出框\n * 使用说明：\n * 如弹框引用 <PresetRuleChange width=\"680\" @save-confirm=\"saveConfirmOk\"></PresetRuleChange>\n *  发消息来 presetRuleChangeEvent,如下：\n *  this.$emit('presetRuleChangeEvent', {\n        type: 6, // 业务分类 1:贷前;5:验证;6:贷中,必传项\n        ruleType: 'Rule_W_SpecialList_c_pdl', // 规则集编码\n        typeVersion: '1.0', // 规则集版本号\n        ids: ['246725', '246726'] // 公司内部预置规则id数组\n      });\n * 2019.3.4\n * hl\n */\nimport TableMergeCell from '../table/TableMergeCell';\nimport Cookies from 'js-cookie';\nimport Qs from 'qs';\nexport default {\n  name: 'PresetRuleChange',\n  components: {\n    TableMergeCell\n  },\n  props: {\n    value: {type: Boolean, default: false},\n    title: {type: String, default: '风险提示'},\n    width: {default: 600}\n  },\n  data () {\n    return {\n      loading: false,\n      save_loading: false,\n      visible: this.value,\n      authStrategyCfgEg: {\n        type: 6, // 业务分类 1:贷前;5:验证;6:贷中,必传项\n        ruleType: 'Rule_W_SpecialList_c_pdl', // 规则集编码\n        typeVersion: '1.0', // 规则集版本号\n        ids: ['246725', '246726'] // 公司内部预置规则id数组\n      },\n      authStrategyCfg: {},\n      options: {\n        method: 'GET',\n        headers: {'Accept': 'application/json', 'Content-Type': 'application/json'},\n        credentials: 'same-origin', // 'same-origin', include\n        mode: 'cors',\n        cache: 'force-cache'\n      },\n      columnsPresetRule: [\n        {\n          title: '规则编号',\n          width: 85,\n          merge: 'ruleCode',\n          key: 'ruleCode'\n        },\n        {\n          title: '修改参数',\n          width: 85,\n          key: 'nameChange'\n        },\n        {\n          title: '当前规则',\n          render: (h, params) => {\n            let isLogic = !!(params.row.currentRule && typeof params.row.currentRule === 'object');\n            let names = isLogic ? params.row.currentRule : [];\n            let liArr = [];\n            for (let i = 0; i < names.length; i++) {\n              let itemSpan = h('span', names[i]);\n              let itemLi = h('li', {\n                style: {'margin-bottom': '3px', 'list-style': 'none'}\n              }, [itemSpan]);\n              liArr.push(itemLi);\n            }\n            return isLogic ? h('ul', [liArr]) : h('span', params.row.currentRule);\n          },\n          key: 'currentRule'\n        },\n        {\n          title: '变更后规则',\n          render: (h, params) => {\n            let isLogic = !!(params.row.afterRule && typeof params.row.afterRule === 'object');\n            let names = isLogic ? params.row.afterRule : [];\n            let liArr = [];\n            for (let i = 0; i < names.length; i++) {\n              let itemSpan = h('span', names[i]);\n              let itemLi = h('li', {\n                style: {'margin-bottom': '3px', 'list-style': 'none'}\n              }, [itemSpan]);\n              liArr.push(itemLi);\n            }\n            return isLogic ? h('ul', [liArr]) : h('span', params.row.afterRule);\n          },\n          key: 'afterRule'\n        }\n      ],\n      strategyDataGroup: []\n    };\n  },\n  methods: {\n    // 一个编号下面，多个数组表达式组成的字符数据\n    ruleLogicStr (jsonVal) {\n      let length = jsonVal.fieldsZn ? jsonVal.fieldsZn.length : 0;\n      /// 逻辑符号 把数据库中 两个以上 这种 [\"||\",\"\"] 修改为 [\"\",\"||\"]\n      // let logicsArr = jsonVal.logics;\n      // if (logicsArr && logicsArr.length >= 2) {\n      //   logicsArr.unshift(logicsArr[logicsArr.length - 1]); // 从最后添加到第一个位置\n      //   logicsArr.pop(); // 把最后一个符号删除掉\n      // } else {\n      //   logicsArr = jsonVal.logics;\n      // }\n      // jsonVal.logicArr = logicsArr;\n      // console.log('logics', jsonVal.logics, logicsArr)\n\n      let ruleLogicList = [];\n      let expression = '';\n      for (let i = 0; i < length; i++) {\n        let ruleLogic = {};\n        ruleLogic.leftBracks = /^\\(/g.test(jsonVal.fieldsZn[i]) ? ' ( ' : ' '; // 括号\n        // ruleLogic.rightBracks = !!/\\)$/g.test(jsonVal.fieldsZn[i]); // 括号\n        ruleLogic.rightBracks = /\\)$/g.test(jsonVal.params[i]) ? ' ) ' : ' '; // 括号\n        ruleLogic.field = jsonVal.fieldsZn[i].match(/([^()]+)/g)[0];\n        ruleLogic.operator = ' ' + jsonVal.operators[i] + ' ';\n        ruleLogic.logic = jsonVal.logics[i] + ' ';\n        // ruleLogic.param = parseFloat(jsonVal.params[i]) + '';\n        ruleLogic.param = parseFloat(jsonVal.params[i].match(/([^()]+)/g)[0]) + ' ';\n        ruleLogic.index = i;\n        expression = ruleLogic.leftBracks + ruleLogic.field + ruleLogic.operator + ruleLogic.param + ruleLogic.rightBracks + ruleLogic.logic;\n        ruleLogicList.push(expression);\n      }\n      return ruleLogicList;\n    },\n    ruleDataFormat (item, columnName, ruleItem) {\n      Object.keys(item).forEach((key, i) => {\n        switch (key) {\n          case 'ruleName':\n            if (item.ruleName) {\n              ruleItem.ruleName = {...ruleItem.ruleName, ruleCode: item.ruleCode, nameChange: '规则名称'};\n              ruleItem.ruleName[columnName] = item.ruleName;\n            }\n            break;\n          case 'priority':\n            if (item.priority + '' === '0' || item.priority >= 1) {\n              ruleItem.priority = {...ruleItem.priority, ruleCode: item.ruleCode, nameChange: '规则权重'};\n              ruleItem.priority[columnName] = item.priority;\n            }\n            break;\n          case 'status':\n            if (item.status + '' === '0' || item.status + '' === '1') {\n              ruleItem.status = {...ruleItem.status, ruleCode: item.ruleCode, nameChange: '规则状态'};\n              ruleItem.status[columnName] = item.status + '' === '1' ? '启用' : '禁用';\n            }\n            break;\n          case 'jsonStr':\n            if (item.jsonStr && item.jsonStr.fieldsZn) {\n              ruleItem.jsonStr = {...ruleItem.jsonStr, ruleCode: item.ruleCode, nameChange: '规则逻辑'};\n              ruleItem.jsonStr[columnName] = this.ruleLogicStr(item.jsonStr);\n            }\n            break;\n        }\n      });\n      return ruleItem;\n    },\n    initStrategy () {\n      this.loading = true;\n      // this.options.method = 'GET';\n      this.options.method = 'POST';\n      let url = '/api/rulecenter-service/newBRule/enablingPresetRuleChangeContrast';\n      if (this.options.method === 'GET') {\n        url = url + '?' + Qs.stringify(this.getSid()) + '&' + Qs.stringify(this.authStrategyCfg);\n        delete this.options.body;\n      } else {\n        // this.options.body = Qs.stringify(this.getSid()) + '&' + Qs.stringify(this.authStrategyCfg);\n        url = url + '?' + Qs.stringify(this.getSid())\n        this.options.body = JSON.stringify(this.authStrategyCfg);// 转换为一个 JSON字符串\n      }\n      fetch(url, this.options)\n        .then(response => response.json())\n        .then(({code, data, message}) => {\n          this.loading = false;\n          if (code === '000000') {\n            let groupDataArr = [];\n            // let demoData = JSON.parse('{\"code\":\"000000\",\"data\":[{\"afterAlterationRule\":{\"id\":271122,\"jsonStr\":{\"ruleType\":\"Rule_C_AirTravel_d1\",\"ruleName\":\"航空消费能力较低\",\"priority\":10,\"operators\":[\"<=\"],\"fieldsZn\":[\"航空消费能力等级\"],\"ruleCode\":\"FAA001\",\"params\":[\"23\"],\"logics\":[\"\"],\"fields\":[\"i_AirExpense_score\"]},\"priority\":null,\"ruleCode\":\"FAA001\",\"ruleName\":\"\",\"status\":null},\"currentRule\":{\"id\":471229,\"jsonStr\":{\"ruleType\":\"Rule_C_AirTravel_d1\",\"ruleName\":\"航空消费能力较低\",\"priority\":10,\"operators\":[\"<=\"],\"fieldsZn\":[\"航空消费能力等级\"],\"ruleCode\":\"FAA001\",\"params\":[\"25\"],\"logics\":[\"\"],\"fields\":[\"i_AirExpense_score\"]},\"priority\":null,\"ruleCode\":\"FAA001\",\"ruleName\":\"\",\"status\":null}},{\"afterAlterationRule\":{\"id\":271123,\"jsonStr\":{\"ruleType\":\"Rule_C_AirTravel_d1\",\"ruleName\":\"航空消费能力较高\",\"priority\":5,\"operators\":[\">=\",\"<=\"],\"fieldsZn\":[\"航空消费能力等级\",\"航空消费能力等级\"],\"ruleCode\":\"FAA002\",\"params\":[\"25\",\"59\"],\"logics\":[\"且\",\"\"],\"fields\":[\"i_AirExpense_score\",\"i_AirExpense_score\"]},\"priority\":null,\"ruleCode\":\"FAA002\",\"ruleName\":\"\",\"status\":null},\"currentRule\":{\"id\":471230,\"jsonStr\":{\"ruleType\":\"Rule_C_AirTravel_d1\",\"ruleName\":\"航空消费能力较高\",\"priority\":5,\"operators\":[\">=\",\"<=\"],\"fieldsZn\":[\"航空消费能力等级\",\"航空消费能力等级\"],\"ruleCode\":\"FAA002\",\"params\":[\"25\",\"61\"],\"logics\":[\"且\",\"\"],\"fields\":[\"i_AirExpense_score\",\"i_AirExpense_score\"]},\"priority\":null,\"ruleCode\":\"FAA002\",\"ruleName\":\"\",\"status\":null}}],\"message\":\"成功\"}');\n            // let data = demoData.data;\n            if (data && data.length >= 1) {\n              this.visible = true;\n              data.forEach(item => {\n                // 增加列字段columnName currentRule afterRule\n                let currentRule = this.ruleDataFormat(item.currentRule, 'currentRule', {})\n                let mergeRule = this.ruleDataFormat(item.afterAlterationRule, 'afterRule', currentRule)\n                // mergeRule.jsonStr.afterRule = 'afterAlterationRuleafterAlterationRuleafterAlterationRuleafterAlterationRule'.split('e')\n                Object.keys(mergeRule).forEach((key, i) => {\n                  groupDataArr.push(mergeRule[key]);\n                });\n              });\n            } else {\n              this.visible = false;\n              this.$emit('save-confirm');\n            }\n            this.strategyDataGroup = groupDataArr;\n          } else {\n            this.$Message.error(message || '服务器错误！');\n          }\n        }, reason => {\n          this.$Message.error(reason || '服务器错误！');\n        });\n    },\n    getSid (sessionId = Cookies.get('BR_COMPASS_SESSIONID')) {\n      return {sessionId, t: Date.now()};\n    },\n    resetParams () {\n      this.save_loading = false;\n    },\n    ok () {\n      // this.save_loading = true;\n      this.$emit('save-confirm');\n      this.visible = false;\n      this.resetParams();\n    },\n    cancel () {\n      this.visible = false;\n      this.$emit('input', false);\n      this.resetParams();\n    }\n  },\n  watch: {\n    value (v) {\n      this.visible = v;\n    }\n  },\n  mounted () {\n    this.$parent.$on('presetRuleChangeEvent', (evt) => {\n      this.authStrategyCfg.type = evt.type;\n      this.authStrategyCfg.typeVersion = evt.typeVersion;\n      this.authStrategyCfg.ruleType = evt.ruleType;\n      this.authStrategyCfg.ids = evt.ids;\n      this.initStrategy();\n      this.$forceUpdate();\n    });\n  }\n};\n</script>\n"],"sourceRoot":"node_modules/@bairong/jax/src/components/rules"}]}