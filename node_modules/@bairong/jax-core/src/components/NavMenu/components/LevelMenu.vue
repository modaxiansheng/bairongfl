<template>
  <li v-if="isChildren" class="level-menu-root">
    <Dropdown placement="bottom" @on-click="handleMenuClick" :class='dropdownClass'>
      <div class="menu-hover level-menu-root-title" @click="handleClick(data.name)">
        <NavIcon :data="data"></NavIcon>
        <span>{{data.title}}</span>
      </div>
      <DropdownMenu slot="list">
        <template v-for="(item, index) in data.children">
          <DropdownItem v-if='!item.children || !item.children.length' :key="'dpchild' + index" :name="item.name">
            <NavIcon :data="item"></NavIcon>
            <span class="dropdown-menu-title">{{item.title}}</span>
          </DropdownItem>
          <PDropdownMenu v-else
            :key="'dpchildren' + index"
            :data="item"
            :children-key="childrenKey"
            :theme='theme'
            @on-select="handleMenuClick">
            <template slot="dropContent">
              <div class="dp-children">
                <NavIcon :data="item"></NavIcon>
                <span class="dropdown-menu-title">{{item.title}}</span>
                <Icon type="ios-arrow-right" class='dp-right-icon'></Icon>
              </div>
            </template>
          </PDropdownMenu>
        </template>
      </DropdownMenu>
    </Dropdown>
  </li>
  <li v-else class="level-menu-root">
    <div class="menu-hover level-menu-root-title" @click="handleClick(data.name)">
      <NavIcon :data="data"></NavIcon>
      <span>{{data.title}}</span>
    </div>
  </li>
</template>

<script>
import NavIcon from './NavIcon';
import PDropdownMenu from './PDropdownMenu';

export default {
  name: 'LevelMenu',
  components: {
    NavIcon, PDropdownMenu
  },
  data () {
    return {};
  },
  props: {
    data: {
      type: Object,
      default () {
        return {};
      }
    },
    theme: {
      type: String,
      default: 'dark'
    },
    childrenKey: {
      type: String,
      default: 'children'
    }
  },
  computed: {
    isChildren () {
      return this.data[this.childrenKey] && this.data[this.childrenKey].length;
    },
    dropdownClass () {
      return `dropdown-theme-${this.theme}`;
    }
  },
  methods: {
    handleClick (name) {
      this.$emit('on-select', name);
    },
    handleMenuClick (name) {
      this.$emit('on-select', name);
    }
  }
};
</script>

<style lang="less" scoped>

</style>
