<template>
  <div class="theme-wrap">
    <Poptip trigger="click" :transfer='false' width="100">
      <Tooltip transfer :content="'换肤'" placement="top">
        <a href="javascript:void(0)">
          <Icon :style="{marginTop: '-2px', verticalAlign: 'middle'}" color="#fff" :size="22" custom="br-icon br-icon-theme"></Icon>
  <!--        <Icon :size="18" color="#fff" type="md-arrow-dropdown"></Icon>-->
        </a>
      </Tooltip>
      <div slot="content" :style="'min-width: 56px;overflow: hidden;'">
          <div class="display-block m-b-1 text-center">
            <span style="margin-right:10px;">主题</span>
            <span >菜单</span>
          </div>
          <Row type="flex" justify="center" align="top" class="text-center">
          <Col span="12">
            <div v-for="(item, index) in themeList.element" :key="index" :name="item.name" @click="setTheme(item.name)" >
              <span v-if="mainTheme!==item.name" class="display-inline-block m-b-1 circle" :style="'background-color:'+item.color"></span>
              <Icon v-if="mainTheme===item.name" :size="24" class="m-b-1" type="ios-checkmark-circle" :color="item.color"/>
            </div>
          </Col>
          <Col span="12">
            <div v-for="(item, index) in themeList.menu" :key="index" :name="item.name" @click="setMenu(item.name)" >
              <span v-if="menuTheme!==item.name" class="display-inline-block m-b-1 circle" :style="'background-color:'+item.color"></span>
              <Icon v-if="menuTheme===item.name" :size="24" class="m-b-1" type="ios-checkmark-circle" :color="item.color"/>
            </div>
          </Col>
          </Row>
      </div>
    </Poptip>
  </div>
</template>

<script>
import Cookies from 'js-cookie';
export default {
  name: 'themeSwitch',
  data () {
    return {
      themeList: {
        menu: [
          {
            name: 'dark',
            color: '#090F1C'
          },
          {
            name: 'light',
            color: '#F5F5F5'
          }
        ],
        element: [
          {
            name: 'dodgerBlue',
            color: '#2A80EA'
          },
          {
            name: 'turquoise',
            color: '#2ABEBD'
          },
          {
            name: 'slateBlue',
            color: '#5D55FF'
          }
        ]
      },
      mainTheme: 'dodgerBlue',
      menuTheme: 'dark'
    };
  },
  methods: {
    /**
       * 可以定制皮肤和颜色，目前只换肤
       * @param themeFile
       */
    setTheme (themeFile) {
      this.$Spin.show();
      setTimeout(() => {
        this.$Spin.hide();
      }, 1000);
      this.mainTheme = themeFile;
      let themeLink = document.querySelector('link[name="theme"]');
      let userName = this.$store.state.user.userName || '';
      localStorage.theme = JSON.stringify([{
        userName: userName,
        mainTheme: this.mainTheme,
        menuTheme: this.menuTheme
      }]);
      let stylePath = 'theme/';
      let path = stylePath + themeFile + '.css';
      setTimeout(() => {
        themeLink.setAttribute('href', path);
      }, 500);
      document.querySelector('body').className = this.mainTheme;
    },
    setMenu (themeName) {
      this.menuTheme = themeName;
      this.$store.commit('changeMenuTheme', themeName);
      let userName = this.$store.state.user.userName || '';
      localStorage.theme = JSON.stringify([{
        userName: userName,
        mainTheme: this.mainTheme,
        menuTheme: this.menuTheme
      }]);
    }
  },
  created () {
    if (localStorage.theme) {
      JSON.parse(localStorage.theme).some(item => {
        this.menuTheme = item.menuTheme;
        this.mainTheme = item.mainTheme;
        this.$store.commit('changeMenuTheme', item.menuTheme);
        this.$store.commit('changeMainTheme', item.mainTheme);
      });

    } else {
      this.$store.commit('changeMenuTheme', 'dark');
      this.$store.commit('changeMainTheme', 'dodgerBlue');
    }
    // 根据用户设置主题
    let stylePath = './theme/';
    let mainTheme = this.$store.state.app.mainTheme || this.mainTheme;
    let stylesheetPath = stylePath + mainTheme + '.css';
    let themeLink = document.querySelector('link[name="theme"]');
    themeLink.setAttribute('href', stylesheetPath);
  },
  mounted () {
    document.querySelector('body').className = this.mainTheme;
  }
};
</script>
<style lang="less" scoped>
  @import 'index.less';
</style>
<style lang="less">
  .theme-wrap {
    .circle {
      width: 20px;
      height: 20px;
      border-radius: 10px; /* 图形的半径 */
      cursor: pointer;
    }
    .ivu-poptip-popper {
      min-width: 100px !important;
    }
  }
  .theme(@mainColor: #2A80EA) {
    //@primary-color: @mainColor
    .icon-theme-color,
    .text-theme-color {
      color: @mainColor;
    }
    .theme-main-color {
      background: @mainColor;
    }
    .border-theme-color {
      border: 1px solid @mainColor;
    }
    .border-them-shadow {
      -webkit-box-shadow: 0 0 4px 0 @mainColor;
      box-shadow: 0 0 4px 0 @mainColor;
    }
  }

  .dodgerBlue {
    .theme();//默认的样式
  }

  .turquoise {
    .theme(#2ABEBD);
  }

  .slateBlue {
    .theme(#5D55FF);
  }
</style>
