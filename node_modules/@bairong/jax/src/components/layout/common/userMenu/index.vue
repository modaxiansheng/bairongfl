<template>
  <div class="user-dropdown-menu-con">
    <Row type="flex" justify="end" align="middle" class="user-dropdown-innercon">
      <Avatar icon="md-person" style="background: #619fe7;margin-left:10px;"></Avatar>
      <Dropdown transfer placement="bottom-end" trigger="click" @on-click="handleClickUserDropdown">
        <a href="javascript:void(0)">
          <span class="main-user-name">{{ userName }}</span>
          <Icon type="md-arrow-dropdown" class="main-user-icon"></Icon>
        </a>
        <DropdownMenu slot="list">
          <DropdownItem name="editPwd">修改密码</DropdownItem>
          <DropdownItem name="logout" divided>退出登录</DropdownItem>
        </DropdownMenu>
      </Dropdown>
    </Row>
    <own-space v-if="showOwnSpace" ref="ownSpace" :isShowOwnSpace="showOwnSpace" @hideOwnSpace="handleHideOwnSpace"></own-space>
  </div>
</template>

<script>
import { mapActions, mapGetters } from 'vuex';
import ownSpace from '../ownSpace';
export default {
  name: 'userMenu',
  props: {
  },
  data () {
    return {
      showOwnSpace: false
    };
  },
  components: {
    ownSpace
  },
  computed: {
    ...mapGetters('user/', ['editPasswordStatus']),
    userName () {
      return this.$store.state.user.userName;
    }
  },
  methods: {
    handleClickUserDropdown (name) {
      // 修改密码
      if (name === 'editPwd') {
        this.showOwnSpace = true;
      } else if (name === 'logout') {
        // 退出登录
        this.$store.dispatch('user/handleLogout');
      }
    },
    handleHideOwnSpace () {
      this.showOwnSpace = false;
    }
  },
  mounted () {
  },
  watch: {
    editPasswordStatus (val) {
      if (val && val.code === '000000') {
        this.$Message.success('修改成功');
        this.handleHideOwnSpace();
      } else {
        this.$Message.error(val.message);
      }
    }
  }
};
</script>

<style lang="less" scoped>
  .header-menu-item {
    display: inline-block;
    padding: 0 20px;
    width: 100%;
    height: 100%;
  }
</style>
